<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoQuiz SVT - Club Environnement & Santé</title>
    
    <!-- 1. CHARGEMENT DES OUTILS (Tailwind, React, Babel) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 2. CONFIGURATION DU STYLE -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'] },
            colors: {
              'club-blue': { 50:'#eff6ff', 100:'#dbeafe', 500:'#3b82f6', 600:'#2563eb', 700:'#1d4ed8', 800:'#1e40af', 900:'#1e3a8a' },
              nature: { 50:'#f0fdf4', 100:'#dcfce7', 200:'#bbf7d0', 300:'#86efac', 400:'#4ade80', 500:'#22c55e', 600:'#16a34a', 700:'#15803d', 800:'#166534', 900:'#14532d' }
            },
            animation: { blob: "blob 7s infinite" },
            keyframes: {
              blob: {
                "0%": { transform: "translate(0px, 0px) scale(1)" },
                "33%": { transform: "translate(30px, -50px) scale(1.1)" },
                "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
                "100%": { transform: "translate(0px, 0px) scale(1)" }
              }
            }
          }
        }
      }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Inter', sans-serif; background-color: #f0fdf4; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 3. CODE DE L'APPLICATION (REACT) -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- DONNÉES ET CONSTANTES ---
        const DEFAULT_GROUPS = [
            { id: 1, name: 'Groupe 1', score: 0, color: 'bg-blue-500' },
            { id: 2, name: 'Groupe 2', score: 0, color: 'bg-red-500' },
            { id: 3, name: 'Groupe 3', score: 0, color: 'bg-yellow-500' },
            { id: 4, name: 'Groupe 4', score: 0, color: 'bg-purple-500' },
        ];

        const QUESTIONS = [
            { id: 1, text: "Quel instrument utilise-t-on pour mesurer la hauteur d’un arbre sans grimper ?", options: ["Un thermomètre", "Un dendromètre", "Un baromètre", "Un anémomètre"], correctAnswerIndex: 1 },
            { id: 2, text: "Dans la méthode du dendromètre, que représente la lettre D dans la formule H = D + h ?", options: ["Le diamètre du tronc", "La densité du feuillage", "La distance entre l’observateur et l’arbre", "La durée de l'observation"], correctAnswerIndex: 2 },
            { id: 3, text: "Si un sol a un pH de 4, il est… ?", options: ["Basique", "Neutre", "Acide", "Alcalin"], correctAnswerIndex: 2 },
            { id: 4, text: "Quel type de sol est généralement le plus acide ?", options: ["Sol calcaire", "Sol siliceux", "Sol argileux", "Sol limoneux"], correctAnswerIndex: 1 },
            { id: 5, text: "Lors de l’atelier perméabilité, quel type de sol laisse s’écouler l’eau le plus rapidement ?", options: ["Sol sableux", "Sol argileux", "Sol humifère", "Sol limoneux"], correctAnswerIndex: 0 },
            { id: 6, text: "Quelle caractéristique permet à un sol de retenir l’eau plus longtemps ?", options: ["Forte porosité", "Présence de graviers", "Faible perméabilité", "Couleur claire"], correctAnswerIndex: 2 },
            { id: 7, text: "Comment calcule-t-on la porosité d’un sol ?", options: ["(volume d’eau écoulé / volume total) × 100", "(masse sèche / volume total) × 100", "(volume total - volume d'eau) × 100", "masse de l'eau / densité"], correctAnswerIndex: 0 },
            { id: 8, text: "Quel type de sol a généralement la porosité la plus élevée ?", options: ["Sol compacté", "Sol rocheux", "Sol cendreux", "Sol sableux pur"], correctAnswerIndex: 2 },
            { id: 9, text: "Pourquoi utilise-t-on de l’eau distillée dans l’analyse du pH du sol ?", options: ["Pour diluer la couleur du sol", "Pour augmenter l'acidité", "Pour ne pas fausser la mesure avec des ions étrangers", "Car c'est moins cher"], correctAnswerIndex: 2 },
            { id: 10, text: "Quel atelier nous permet de comparer la capacité de rétention en eau de différents sols ?", options: ["Mesure de la hauteur", "Perméabilité et rétention", "Mesure du pH", "Mesure de la température"], correctAnswerIndex: 1 },
        ];

        // --- COMPOSANTS ICÔNES (SVG direct) ---
        const IconPlay = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const IconDroplets = () => <svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const IconArrowRight = () => <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>;
        const IconArrowLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>;
        const IconEye = () => <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>;
        const IconTrophy = ({size=24, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const IconLeaf = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>;
        const IconHome = () => <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const IconRotate = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;

        // --- ÉCRAN 1: CONFIGURATION (SETUP) ---
        const Setup = ({ onStart, initialGroups, initialLogoUrl }) => {
            const [groups, setGroups] = useState(initialGroups || DEFAULT_GROUPS);
            const logoUrl = initialLogoUrl || 'https://i.imgur.com/ha7q7zJ.png';

            const handleGroupNameChange = (id, newName) => {
                setGroups(prev => prev.map(g => g.id === id ? { ...g, name: newName } : g));
            };

            return (
                <div className="w-full max-w-5xl mx-auto p-8 bg-white/95 backdrop-blur shadow-2xl rounded-3xl border-t-8 border-club-blue-600 flex flex-col items-center text-center animate-[fade-in_0.5s_ease-out]">
                    <div className="mb-8 w-full">
                        <div className="flex justify-center mb-4">
                            {logoUrl ? (
                                <img src={logoUrl} alt="Logo Club" className="h-32 object-contain drop-shadow-md transition-transform hover:scale-105 duration-500" />
                            ) : (
                                <div className="text-club-blue-600"><IconDroplets /></div>
                            )}
                        </div>
                        <h1 className="text-5xl font-black text-nature-800 mb-2 tracking-tight">Eco Quiz SVT</h1>
                        <div className="space-y-1 mb-6">
                            <h2 className="text-2xl font-bold text-club-blue-800">Lycée qualifiant Abou El Kacem Ezzayani - Khénifra</h2>
                            <h3 className="text-xl font-semibold text-gray-600">Club environnement et santé</h3>
                        </div>
                        <div className="inline-block bg-gradient-to-r from-nature-100 to-club-blue-100 px-6 py-2 rounded-full border border-nature-200 shadow-sm">
                            <span className="text-lg font-bold text-nature-900 uppercase tracking-widest">Olympiades de l'Environnement</span>
                        </div>
                    </div>

                    <div className="w-full max-w-3xl mb-10">
                        <h4 className="text-lg font-medium text-gray-500 mb-4 uppercase tracking-wider">— Les Participants —</h4>
                        <div className="grid grid-cols-2 gap-4">
                            {groups.map((group) => (
                                <div key={group.id} className="relative group transition-all duration-300 hover:-translate-y-1">
                                    <div className={`absolute inset-y-0 left-0 w-3 rounded-l-lg ${group.color}`}></div>
                                    <input
                                        type="text"
                                        value={group.name}
                                        onChange={(e) => handleGroupNameChange(group.id, e.target.value)}
                                        className="w-full text-xl font-bold text-gray-700 p-3 pl-5 border-2 border-gray-200 rounded-lg rounded-l-none focus:border-club-blue-500 focus:ring-4 focus:ring-club-blue-100 outline-none transition-all shadow-sm group-hover:shadow-md text-center"
                                        placeholder={`Groupe ${group.id}`}
                                    />
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="mt-auto">
                        <button onClick={() => onStart(groups, QUESTIONS, logoUrl)} className="flex items-center gap-3 bg-gradient-to-r from-nature-600 to-club-blue-600 hover:from-nature-700 hover:to-club-blue-700 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-xl transition-all transform hover:scale-105 hover:shadow-2xl active:scale-95 ring-4 ring-transparent hover:ring-nature-200">
                            Lancer le Quiz <IconPlay />
                        </button>
                    </div>
                </div>
            );
        };

        // --- ÉCRAN 2: JEU (GAME INTERFACE) ---
        const POINTS_PER_CORRECT = 2;

        const GameInterface = ({ questions, groups, logoUrl, onUpdateScore, onFinish, onExit }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [isRevealed, setIsRevealed] = useState(false);
            const [selections, setSelections] = useState({});

            const currentQuestion = questions[currentQuestionIndex];
            const isLastQuestion = currentQuestionIndex === questions.length - 1;
            const currentAwardedGroups = selections[currentQuestionIndex] || [];

            const handleReveal = () => setIsRevealed(true);

            const handleToggleGroupScore = (groupId) => {
                const isSelected = currentAwardedGroups.includes(groupId);
                if (isSelected) {
                    onUpdateScore(groupId, -POINTS_PER_CORRECT);
                    setSelections(prev => ({ ...prev, [currentQuestionIndex]: prev[currentQuestionIndex].filter(id => id !== groupId) }));
                } else {
                    onUpdateScore(groupId, POINTS_PER_CORRECT);
                    setSelections(prev => ({ ...prev, [currentQuestionIndex]: [...(prev[currentQuestionIndex] || []), groupId] }));
                }
            };

            const handleNext = () => {
                if (isLastQuestion) onFinish();
                else {
                    const nextIndex = currentQuestionIndex + 1;
                    setCurrentQuestionIndex(nextIndex);
                    setIsRevealed(!!selections[nextIndex]);
                }
            };
            
            const handlePrevious = () => {
                if (currentQuestionIndex > 0) {
                    setCurrentQuestionIndex(prev => prev - 1);
                    setIsRevealed(true);
                }
            };

            return (
                <div className="flex flex-col h-screen max-h-screen overflow-hidden relative font-sans">
                    <div className="absolute inset-0 bg-cover bg-center z-0" style={{ backgroundImage: 'url("https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=2560&auto=format&fit=crop")' }} />
                    <div className="absolute inset-0 bg-black/5 z-0"></div>

                    <div className="relative z-10 flex flex-col h-full">
                        <header className="bg-white/90 backdrop-blur-md shadow-md border-b border-white/50 py-3 px-6 flex justify-between items-center z-50 shrink-0 relative">
                            <div className="flex items-center gap-4 z-20 relative max-w-[40%]">
                                <button onClick={onExit} className="p-2 mr-2 text-gray-600 hover:text-club-blue-600 hover:bg-white/50 rounded-full transition-colors cursor-pointer shrink-0" title="Retour à l'accueil"><IconHome /></button>
                                <div className="w-14 h-14 bg-white/90 rounded-full flex items-center justify-center overflow-hidden border-2 border-club-blue-500 shadow-sm shrink-0">
                                    {logoUrl ? <img src={logoUrl} alt="Logo" className="w-full h-full object-contain p-1" /> : <div className="text-nature-600"><IconLeaf /></div>}
                                </div>
                                <div className="flex flex-col min-w-0">
                                    <h1 className="text-xl font-bold text-club-blue-900 leading-tight truncate">Club Environnement & Santé</h1>
                                    <p className="text-sm text-nature-800 font-bold truncate">Lycée qualifiant Abou El Kacem Ezzayani - Khénifra</p>
                                </div>
                            </div>
                            <div className="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 hidden lg:flex items-center justify-center z-10 pointer-events-none">
                                <div className="border-2 border-nature-600 bg-nature-50/95 backdrop-blur text-nature-800 px-8 py-2 rounded-xl font-black uppercase tracking-widest text-xl shadow-md pointer-events-auto">
                                    Olympiades de l'environnement
                                </div>
                            </div>
                            <div className="hidden md:block bg-white/50 text-club-blue-800 px-4 py-1.5 rounded-full text-sm font-semibold border border-white/60 shadow-sm backdrop-blur-sm z-20">Mode Présentateur</div>
                        </header>

                        <div className="flex flex-1 overflow-hidden p-6 gap-8 justify-center">
                            <main className="flex-1 flex flex-col h-full max-w-7xl w-full">
                                <div className="flex flex-col h-full justify-center gap-6">
                                    <div className="bg-white/85 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-white/60 flex-shrink-0">
                                        <div className="mb-4 flex items-center">
                                            <span className="bg-club-blue-600 text-white px-5 py-1.5 rounded-full font-bold text-base uppercase tracking-wide shadow-sm">Question {currentQuestionIndex + 1} / {questions.length}</span>
                                            <div className="h-1 bg-gradient-to-r from-club-blue-600/30 to-transparent flex-1 ml-4 rounded-full"></div>
                                        </div>
                                        <h2 className="text-3xl md:text-4xl font-extrabold text-gray-900 leading-tight drop-shadow-sm">{currentQuestion.text}</h2>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
                                        {currentQuestion.options.map((option, index) => {
                                            const isCorrect = index === currentQuestion.correctAnswerIndex;
                                            const showCorrect = isRevealed && isCorrect;
                                            const showIncorrect = isRevealed && !isCorrect;
                                            let borderClass = "border-nature-200/80 hover:border-club-blue-400";
                                            let bgClass = "bg-nature-100/90 backdrop-blur-md hover:bg-nature-200/90"; 
                                            let textClass = "text-gray-800";
                                            let letterBg = "bg-white/70 text-nature-800";

                                            if (showCorrect) {
                                                borderClass = "border-nature-600 ring-4 ring-nature-400/50";
                                                bgClass = "bg-nature-300/90";
                                                textClass = "text-nature-900 font-bold";
                                                letterBg = "bg-nature-700 text-white";
                                            } else if (showIncorrect) {
                                                bgClass = "bg-white/40 opacity-50";
                                                borderClass = "border-transparent";
                                            }

                                            return (
                                                <div key={index} className={`relative p-5 rounded-2xl border-2 shadow-lg transition-all duration-300 flex items-center ${borderClass} ${bgClass}`}>
                                                    <div className="flex items-center gap-5 w-full">
                                                        <div className={`w-12 h-12 rounded-full flex items-center justify-center text-xl font-bold flex-shrink-0 shadow-inner ${letterBg}`}>{['A', 'B', 'C', 'D'][index]}</div>
                                                        <span className={`text-xl md:text-2xl leading-snug ${textClass}`}>{option}</span>
                                                    </div>
                                                    {showCorrect && <div className="absolute top-1/2 -translate-y-1/2 right-5 text-nature-700 animate-bounce"><IconCheck /></div>}
                                                </div>
                                            );
                                        })}
                                    </div>

                                    <div className="bg-white/90 backdrop-blur-xl p-5 rounded-2xl border border-white/60 shadow-2xl shrink-0 mt-2">
                                        <div className="flex flex-col lg:flex-row items-center justify-between gap-4">
                                            <div className="text-sm font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2 bg-gray-100/50 px-4 py-2 rounded-lg border border-gray-200/50">
                                                <div className="w-2.5 h-2.5 rounded-full bg-orange-400 animate-pulse"></div> Panneau de contrôle
                                            </div>
                                            <div className="flex gap-4 w-full lg:w-auto justify-end items-center flex-wrap">
                                                {currentQuestionIndex > 0 && (
                                                    <button onClick={handlePrevious} className="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-3 rounded-xl font-bold transition-colors shadow-sm"><IconArrowLeft /></button>
                                                )}
                                                {!isRevealed ? (
                                                    <button onClick={handleReveal} className="flex-1 lg:flex-none flex items-center justify-center gap-3 bg-club-blue-600 hover:bg-club-blue-700 text-white px-10 py-3 rounded-xl font-bold text-xl transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5"><IconEye /> Afficher la réponse</button>
                                                ) : (
                                                    <div className="flex flex-col lg:flex-row items-center gap-4 w-full lg:w-auto animate-[fade-in_0.3s_ease-out]">
                                                        <div className="flex items-center gap-2 bg-gray-50 p-2 rounded-xl border border-gray-200 w-full lg:w-auto justify-center shadow-inner">
                                                            <span className="text-sm font-semibold mr-2 text-gray-500 uppercase tracking-wide hidden sm:inline">Vainqueurs :</span>
                                                            {[...groups].sort((a, b) => a.id - b.id).map(group => (
                                                                <button key={group.id} onClick={() => handleToggleGroupScore(group.id)} className={`w-11 h-11 rounded-full flex items-center justify-center font-bold text-lg transition-all border-2 shadow-sm ${currentAwardedGroups.includes(group.id) ? `${group.color} border-transparent text-white ring-2 ring-offset-1 ring-nature-200 transform scale-110 shadow-lg` : 'bg-white border-gray-200 text-gray-300 hover:border-gray-300 hover:bg-gray-50 hover:text-gray-400'}`} title={group.name}>G{group.id}</button>
                                                            ))}
                                                        </div>
                                                        <button onClick={handleNext} className="flex-1 lg:flex-none flex items-center justify-center gap-3 bg-nature-600 hover:bg-nature-700 text-white px-10 py-3 rounded-xl font-bold text-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all w-full lg:w-auto">{isLastQuestion ? 'Terminer' : 'Suivant'} <IconArrowRight /></button>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </main>

                            <aside className="w-80 bg-white/80 backdrop-blur-xl border border-white/50 rounded-2xl p-6 shadow-2xl z-20 hidden md:flex flex-col h-full shrink-0">
                                <div className="flex items-center gap-3 mb-6 text-club-blue-900 font-bold text-xl border-b-2 border-club-blue-100 pb-4">
                                    <div className="bg-yellow-100 p-2 rounded-lg"><IconTrophy className="text-yellow-600" size={24}/></div>
                                    <h3>Classement</h3>
                                </div>
                                <div className="space-y-4 flex-1 overflow-y-auto pr-2">
                                    {[...groups].sort((a, b) => b.score - a.score).map((group, idx) => (
                                        <div key={group.id} className={`relative p-4 rounded-xl border-2 transition-all duration-500 shadow-sm ${idx === 0 && group.score > 0 ? 'bg-gradient-to-r from-yellow-50 to-white border-yellow-300 shadow-md' : 'bg-white border-gray-100'}`}>
                                            <div className="flex justify-between items-center mb-3">
                                                <div className="flex items-center gap-3">
                                                    <span className={`w-7 h-7 rounded-md flex items-center justify-center text-sm font-bold ${idx === 0 ? 'bg-yellow-500 text-white shadow-sm' : 'bg-gray-200 text-gray-600'}`}>{idx + 1}</span>
                                                    <span className="font-bold text-gray-800 text-lg truncate max-w-[140px]">{group.name}</span>
                                                </div>
                                            </div>
                                            <div className="flex items-end justify-between gap-3">
                                                <div className="w-full bg-gray-100 rounded-full h-2.5 mb-1 overflow-hidden flex-1">
                                                    <div className={`${group.color} h-full rounded-full transition-all duration-1000 ease-out`} style={{ width: `${Math.min((group.score / (questions.length * POINTS_PER_CORRECT)) * 100, 100)}%` }}></div>
                                                </div>
                                                <div className="text-right leading-none"><span className="font-mono font-black text-3xl text-gray-800">{group.score}</span></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </aside>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ÉCRAN 3: RÉSULTATS (RESULTS) ---
        const Results = ({ groups, onRestart, logoUrl }) => {
            const sortedGroups = [...groups].sort((a, b) => b.score - a.score);
            const winner = sortedGroups[0];
            const [showConfetti, setShowConfetti] = useState(false);

            useEffect(() => { setShowConfetti(true); }, []);

            return (
                <div className="min-h-screen bg-club-blue-50 flex flex-col items-center justify-center p-4 relative overflow-hidden">
                    <div className="absolute inset-0 overflow-hidden pointer-events-none">
                        <div className="absolute top-0 left-0 w-64 h-64 bg-nature-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
                        <div className="absolute top-0 right-0 w-64 h-64 bg-club-blue-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>
                        <div className="absolute -bottom-8 left-20 w-64 h-64 bg-pink-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"></div>
                    </div>

                    <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 max-w-2xl w-full z-10 text-center border-4 border-club-blue-100">
                        {logoUrl && <img src={logoUrl} alt="Club Logo" className="w-24 h-24 mx-auto mb-6 object-contain" />}
                        <h2 className="text-4xl font-black text-club-blue-900 mb-2">RÉSULTATS FINAUX</h2>
                        <p className="text-nature-700 font-medium text-lg">Lycée qualifiant Abou El Kacem Ezzayani - Khénifra</p>
                        <p className="text-gray-500 mb-10 text-sm">Journée Expérimentale SVT</p>

                        <div className="mb-12 transform scale-110">
                            <div className="relative inline-block">
                                <IconTrophy size={80} className="text-yellow-400 mx-auto drop-shadow-lg mb-4" />
                                <div className="absolute -top-4 -right-4 bg-red-500 text-white font-bold px-3 py-1 rounded-full animate-bounce">WINNER</div>
                            </div>
                            <h3 className="text-3xl font-bold text-gray-800">{winner.name}</h3>
                            <p className="text-5xl font-black text-nature-600 mt-2">{winner.score} <span className="text-xl text-gray-400">pts</span></p>
                        </div>

                        <div className="space-y-3 mb-10 text-left">
                            {sortedGroups.slice(1).map((group, index) => (
                                <div key={group.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100">
                                    <div className="flex items-center gap-4">
                                        <div className="font-bold text-gray-400 w-6 text-xl">#{index + 2}</div>
                                        <div className={`w-3 h-3 rounded-full ${group.color}`}></div>
                                        <span className="font-semibold text-gray-700">{group.name}</span>
                                    </div>
                                    <div className="font-bold text-gray-800">{group.score} pts</div>
                                </div>
                            ))}
                        </div>

                        <button onClick={onRestart} className="bg-club-blue-800 hover:bg-club-blue-900 text-white font-bold py-3 px-8 rounded-full flex items-center gap-2 mx-auto transition-all hover:scale-105 shadow-lg">
                            <IconRotate /> Nouvelle Partie
                        </button>
                    </div>

                    {showConfetti && (
                        <div className="absolute inset-0 pointer-events-none overflow-hidden">
                            {[...Array(30)].map((_, i) => (
                                <div key={i} className="absolute w-3 h-3 rounded-full animate-[ping_3s_ease-in-out_infinite]" style={{ left: `${Math.random() * 100}%`, top: `${Math.random() * 50}%`, backgroundColor: ['#ef4444', '#3b82f6', '#22c55e', '#eab308'][Math.floor(Math.random() * 4)], animationDelay: `${Math.random() * 2}s` }}></div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // --- COMPOSANT PRINCIPAL (APP) ---
        const App = () => {
            const [appState, setAppState] = useState('SETUP');
            const [groups, setGroups] = useState([]);
            const [questions, setQuestions] = useState([]);
            const [logoUrl, setLogoUrl] = useState(null);

            const handleStartGame = (configuredGroups, configuredQuestions, logo) => {
                setGroups(configuredGroups);
                setQuestions(configuredQuestions);
                setLogoUrl(logo);
                setAppState('QUIZ');
            };

            const handleUpdateScore = (groupId, points) => {
                setGroups(prev => prev.map(g => g.id === groupId ? { ...g, score: g.score + points } : g));
            };

            const handleFinishQuiz = () => setAppState('LEADERBOARD');

            const handleRestart = () => {
                setGroups(prev => prev.map(g => ({ ...g, score: 0 })));
                setAppState('SETUP');
            };

            return (
                <div className="min-h-screen font-sans text-gray-800">
                    {appState === 'SETUP' && (
                        <div className="min-h-screen flex items-center justify-center p-4 bg-cover bg-center relative" style={{ backgroundImage: 'url("https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=2560&auto=format&fit=crop")' }}>
                            <div className="absolute inset-0 bg-black/10 backdrop-blur-[1px]"></div>
                            <div className="relative z-10 w-full">
                                <Setup onStart={handleStartGame} initialGroups={groups.length > 0 ? groups : undefined} initialLogoUrl={logoUrl} />
                            </div>
                        </div>
                    )}
                    {appState === 'QUIZ' && (
                        <GameInterface groups={groups} questions={questions} logoUrl={logoUrl} onUpdateScore={handleUpdateScore} onFinish={handleFinishQuiz} onExit={handleRestart} />
                    )}
                    {appState === 'LEADERBOARD' && (
                        <Results groups={groups} onRestart={handleRestart} logoUrl={logoUrl} />
                    )}
                </div>
            );
        };

        // Rendu
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
